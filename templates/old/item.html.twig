{% extends 'old/base.html.twig' %}

{% block body %}
    <div class="container-fluid">
        <div class="row justify-content-center text-center flex-column m-lg-4 m-md-0 pb-4">
            <div class="col-12 mb-5 mt-5">
                <h1>Właśnie kupujesz: {{ item.name }}</h1>
                <h2 class="base">Wybierz formę płatności której chcesz użyć</h2>
            </div>
            <div class="col-12 font-weight-normal">
                <div class="row">
                    {% if app.session.flashbag.peek('error') | length > 0 %}
                        <div class="col-12 alert-info alert mb-5">
                            {% for message in app.flashes('error') %}
                                {{ message | trans }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="row justify-content-center">
                    <div class="gs-item col-lg-7">

                        <div class="gs-item-content-shop text-center d-flex flex-column justify-content-center w-100">
                            <img src="{{ asset('/assets/images/' ~ item.image) }}" alt=""/>
                            <div class="mt-4">
                                <h4 class="font-weight-bold">{{ item.name | upper }}</h4>
                                Kup <span id="counter">{{ item.multiple ? '1' : '' }}</span> za <span id="prize">{{ item.discountedPrice }}</span> zł
                                <div class="gs-item-desc">{{ item.description | raw }}</div>
                            </div>
                        </div>

                    </div>
                    <div class="col-lg-4 col-md-12 p-lg-5 m-4">
                        <div class="row flex-column">
                            {{ form_start(form, {method: 'POST'})}}
                            {{ form_row(form.email) }}
                            {{ form_row(form.username) }}
                            {{ form_row(form.payment) }}
                            {% set class = not item.multiple ? 'd-none': 'd-block' %}
                            <div class="mb-3 {{ class }}">
                                <label for="count" class="form-label required">Ilość</label>
                                {{ form_widget(form.count) }}
                            </div>
                            <div id="psc-code" style="display:none">
                                <ul id="code-fields-list"
                                    data-prototype="{{ form_widget(form.code.vars.prototype)|e }}"
                                    data-widget-tags="{{ '<li></li>'|e }}"
                                    data-widget-counter="{{ form.code|length }}">
                                    {% for code in form.code %}
                                        <li>{{ form_widget(code) }}</li>
                                    {% endfor %}
                                </ul>
                                <button type="button"
                                        class="gs-accept add-another-collection-widget mb-3 w-100"
                                        data-list-selector="#code-fields-list">Dodaj Kod</button>
                            </div>
                            <script>
                                if (document.getElementById('payment').value === 'paySafeCard') {
                                    document.getElementById('psc-code').removeAttribute('style');
                                }

                                document.getElementById('payment').addEventListener('change', (e) => {
                                    e.target.value === 'paySafeCard'
                                        ? document.getElementById('psc-code').removeAttribute('style')
                                        : document.getElementById('psc-code').setAttribute('style', 'display: none;')
                                })
                            </script>
                            {{ form_row(form.check) }}

                            <button type="submit" class="gs-accept w-100">Kup teraz</button>
                            <script>
                                document.getElementById('count').addEventListener('change', (e) => {
                                    const val = e.target.value * {{ item.discountedPrice }};
                                    document.getElementById('prize').innerHTML = val.toFixed(2);
                                    document.getElementById('counter').innerHTML = e.target.value;
                                })
                            </script>
                            {{ form_end(form) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
